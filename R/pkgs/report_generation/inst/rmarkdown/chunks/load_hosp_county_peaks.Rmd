```{r}

if (!LOADED_CONFIG) { stop("This chunk requires the config to be loaded")}
## Code loads the state hospitalization totals if it has not yet been loaded
if (!LOADED_HOSP_CTY_PEAKS) {
    hosp_post_process <- function(x) {
        x %>% 
            ungroup %>%
            filter(!is.na(time)) %>%
            group_by(geoid) %>% 
            dplyr::slice(which.max(hosp_curr)) %>%
            ungroup
    }

    scn_dirs <- paste(config$name,config$interventions$scenarios,sep='_')
    hosp_cty_peaks <- NULL
    
    for (i in 1:length(scn_dirs)) {
        for (pdeath in config$hospitalization$parameters$p_death_names) {
            hosp_cty_peaks <- dplyr::bind_rows(hosp_cty_peaks, load_hosp_sims_filtered(scn_dirs[i],
                                          name_filter = pdeath,
                                          post_process = hosp_post_process) %>% 
                mutate(scenario_num=i, scenario_name=config$report$formatting$scenario_labels[i], pdeath=pdeath))
        }
    }
    
    
    LOADED_HOSP_CTY_PEAKS <- TRUE 
}


```
