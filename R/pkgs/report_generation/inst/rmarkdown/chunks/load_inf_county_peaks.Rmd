```{r}
if(!LOADED_CONFIG){stop("This chunk requires the config to be loaded")}
## Code loads the county infection peaks if it has not yet been loaded
if (!LOADED_INF_CTY_PEAKS) {
  
  inf_pre_process <- function(x) {
    x %>%
      dplyr::filter(comp == "diffI")
  }
  
  inf_post_process <- function(x) {
    x %>% 
      ungroup %>%
      dplyr::filter(!is.na(time)) %>%
      dplyr::mutate(geoid=ifelse(nchar(geoid)==4, paste0("0",geoid),geoid)) %>% 
      dplyr::filter(geoid %in% included_geoids) %>%
      group_by(geoid) %>%
      dplyr::slice(which.max(N)) %>%
      ungroup
  }
  
  scn_dirs <- paste(config$name,config$interventions$scenarios,sep='_')
  inf_cty_peaks <- NULL
  
  for (i in 1:length(scn_dirs)) {
      inf_cty_peaks <- dplyr::bind_rows(inf_cty_peaks, load_scenario_sims_filtered(scn_dirs[i],
                                                                                  pre_process = inf_pre_process,
                                                                                  post_process = inf_post_process) %>% 
                mutate(scenario_num=i,
                       scenario_name=config$report$formatting$scenario_labels[i]))

  }
  
  
  LOADED_INF_CTY_PEAKS <- TRUE 
}


```
