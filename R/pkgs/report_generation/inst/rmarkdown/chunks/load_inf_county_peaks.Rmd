```{r}
## Code loads the county infection peaks if it has not yet been loaded
if (!LOADED_INF_CTY_PEAKS) {
  
  inf_pre_process <- function(x) {
    x %>%
      dplyr::filter(comp == "diffI")
  }
  
  inf_post_process <- function(x) {
    x %>% 
      ungroup %>%
      dplyr::filter(!is.na(time)) %>%
      group_by(geoid) %>%
      dplyr::slice(which.max(N)) %>%
      ungroup
  }
  
  scn_dirs <- params$scenario_dirs
  inf_cty_peaks <- NULL
  
  for (i in 1:length(scn_dirs)) {
      inf_cty_peaks <- dplyr::bind_rows(inf_cty_peaks, load_scenario_sims_filtered(scn_dirs[i],
                                                                                  loc_filter = params$state_fips,
                                                                                  pre_process = inf_pre_process,
                                                                                  post_process = inf_post_process) %>% 
                                              mutate(scenario_num=i, scenario_name=params$scenario_labels[i]))

  }
  
  
  LOADED_INF_CTY_PEAKS <- TRUE 
}


```
