name: test_inference
start_date: 2020-04-01
end_date: 2020-05-15
nsimulations: 1
dt: 0.25

spatial_setup:
  base_path: data
  setup_name: test1
  geodata: geodata.csv
  mobility: mobility.csv
  popnodes: population
  nodenames: geoid
  census_year: 2018
  modeled_states:
    - HI

seeding:
  seeding_compartments:
    incidI:
      source_compartment: ["S", "unvaccinated", "var0"]
      destination_compartment: ["E", "unvaccinated", "var0"]
  seeding_file_type: seed
  method: FolderDraw
  folder_path: importation/test1/
  lambda_file: data/test1/seeding.csv
  perturbation_sd: 3

seir:
  parameters:
    alpha:
      value:
        distribution: fixed
        value: .99
    sigma:
      value:
        distribution: fixed
        value: 1 / 5.2
    gamma:
      value:
        distribution: uniform
        low: 1 / 6
        high: 1 / 2.6
    R0s:
      value:
        distribution: uniform
        low: 2
        high: 3
    theta_1:
      value:
        distribution: fixed
        value: .1
    theta_2:
      value:
        distribution: fixed
        value: .2
    nu_1:
      intervention_overlap_operation : "sum"
      value:
        distribution: fixed
        value: .3
    nu_2:
      intervention_overlap_operation : "sum"
      value:
        distribution: fixed
        value: .4
    chi_0:
      value:
        distribution: fixed
        value: .5
    chi_1:
      value:
        distribution: fixed
        value: .6
    rho:
      intervention_overlap_operation : "prod"
      value:
        distribution: fixed
        value: 7
  compartments:
    infection_stage: ["S", "E", "I1", "I2", "I3", "R"]
    vaccination_stage: ["unvaccinated", "1dose", "2dose"]
    variant_type: ["var0", "var1"]
  transitions:
    - source: ["S", ["unvaccinated", "1dose", "2dose"], "var0"]
      destination: ["E", ["unvaccinated", "1dose", "2dose"], ["var0","var1"]]
      proportional_to: ["source", [["E", "I1", "I2", "I3"], ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]]
      proportion_exponent: [[1,1,1], ["alpha",1,1]]
      rate: ["R0s * gamma", ["1", "theta_1", "theta_2"], ["chi_0", "chi_1"]]
    - source: ["E", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      destination: ["I1", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["sigma", 1, 1]
    - source: ["I1", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      destination: ["I2", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["3 * gamma", 1, 1]
    - source: ["I2", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      destination: ["I3", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["3 * gamma", 1, 1]
    - source: ["I3", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      destination: ["R", ["unvaccinated", "1dose", "2dose"], ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["3 * gamma", 1, 1]
    - source: [["S", "E", "I1", "I2", "I3", "R"], "unvaccinated", ["var0", "var1"]]
      destination: [["S", "E", "I1", "I2", "I3", "R"], "1dose", ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["nu_1", 1, 1]
    - source: [["S", "E", "I1", "I2", "I3", "R"], "1dose", ["var0", "var1"]]
      destination: [["S", "E", "I1", "I2", "I3", "R"], "2dose", ["var0", "var1"]]
      proportional_to: ["source"]
      proportion_exponent: [[1,1,1]]
      rate: ["nu_2", 1, 1]

interventions:
  scenarios:
    # - None
    - Scenario1
  settings:
    None:
      template: ReduceR0
      value:
        distribution: fixed
        value: 0
    Place1:
      template: Reduce
      parameter: r0
      value:
        distribution: uniform
        low: .14
        high: .33
    Place2:
      template: MultiTimeReduce
      parameter: r0
      groups:
        - affected_geoids: "all"
          periods:
          - start_date: "2020-04-01"
            end_date: "2020-04-15"
          - start_date: "2020-05-01"
            end_date: "2020-05-15"
      value:
        distribution: uniform
        low: .14
        high: .33
    Dose1:
      template: Reduce
      parameter: "transition_rate 0"
      period_start_date: 2020-04-10
      period_end_date: 2020-04-10
      value:
        distribution: fixed
        value: 0.9
    Dose2:
      template: Reduce
      parameter: "transition_rate 1"
      period_start_date: 2020-04-11
      period_end_date: 2020-04-11
      value:
        distribution: fixed
        value: 0.9
    vaccination:
      template: Stacked
      scenarios:
        - Dose1
        - Dose2
    Scenario1:
      template: Stacked
      scenarios:
        - Place1
        - Place2
        - vaccination
outcomes:
  method: delayframe
  param_from_file: TRUE
  param_place_file: ../../Outcomes/data/usa-geoid-params-output.parquet
  scenarios:
    - high_death_rate
  settings:
    high_death_rate:
      incidH:
        source: incidI
        probability:
          value:
            distribution: fixed
            value: .1
        delay:
          value:
            distribution: fixed
            value: 7
        duration:
          value:
            distribution: fixed
            value: 7
          name: hosp_curr
      incidD:
        source: incidI
        probability:
          value:
            distribution: fixed
            value: .01
        delay:
          value:
            distribution: fixed
            value: 7
      incidICU:
        source: incidH
        probability:
          value:
            distribution: fixed
            value: .1
        delay:
          value:
            distribution: fixed
            value: 0

filtering:
  simulations_per_slot: 5
  do_filtering: TRUE
  data_path: data/us_data.csv
  likelihood_directory: importation/likelihood/
  statistics:
    sum_deaths:
      name: sum_deaths
      aggregator: sum
      period: "1 weeks"
      sim_var: incidD
      data_var: incidDeath
      remove_na: TRUE
      add_one: FALSE
      likelihood:
        dist: sqrtnorm
        param: [.1]
    sum_hosp:
      name: sum_hosp
      aggregator: sum
      period: "1 days"
      sim_var: incidH
      data_var : incidI
      remove_na: TRUE
      add_one: FALSE
      likelihood:
        dist: sqrtnorm
        param: [.5]
